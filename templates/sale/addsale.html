<!DOCTYPE html>
{% load static %}

<head>
    <title>Add Sale</title>

    <style>
        .btn-icon {
            display: flex;
            align-items: center;
            font-size: 0.8em;
            /* Further reduce button size */
            padding: 0.2rem 0.4rem;
            /* Further reduce padding */
        }

        .btn-icon i {
            margin-right: 3px;
            /* Reduce the gap between icon and text */
        }

        .navbar2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
            padding: 10px 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .financial-year,
        .current-date {
            margin: 25;
            color: #447894;
            margin-left: 40%;
            font-size: x-large;
            font-weight: bolder;
        }

        .breadcrumb {
            margin: 0;
            padding: 0;
            background: none;
        }

        .breadcrumb li {
            display: inline;
            font-size: 12px;
        }

        .breadcrumb li a {
            text-decoration: none;
        }

        .add-button {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
            margin-top: 5px;
            /* Move the button down by 5 pixels */
            margin-right: 50px;
        }

        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 150px;
            /* Ensure the container takes the full width */
            padding: 10px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .container h2 {
            padding: 10px;
            margin: 0 -20px 20px -20px;
            color: #447894;
            font-size: 1.5rem;
            text-align: center;
            font-weight: bolder;
        }

        .container p {
            padding: 5px;
            color: #447894;
            font-size: 1.5rem;
            text-align: center;
            font-weight: bolder;
            margin-right: 20px;
        }

        .container .date {
            text-align: right;
            font-weight: bolder;
            color: #447894;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            background-color: #d9edf7;
            align-items: center;
        }

        .header-container h2 {
            margin: 0;
            margin-left: 0;
            /* Adds 10px space before the heading starts */
        }

        .form-group {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .form-group label {
            flex: 1;
            margin-right: 10px;
        }

        .form-group input,
        .form-group select {
            flex: 2;
            padding: 8px;
        }

        .form-group .small-input {
            flex: 0.5;
        }

        .form-buttons {
            text-align: left;
            margin-top: 15px;
            margin-left: 10px;
        }

        .form-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
        }

        .form-buttons .save-btn {
            background-color: #007bff;
            color: #fff;
            margin-right: 10px;
        }

        .form-buttons .cancel-btn {
            background-color: #dc3545;
            color: #fff;
        }

        .form-table {
            width: 100%;
            border-collapse: collapse;
        }

        .form-table th,
        .form-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .form-table th {
            background-color: #343a40;
            color: #fff;
        }

        .form-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .table-form {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-group {
            flex: 1 1 45%;
            display: flex;
            flex-direction: column;
        }

        .form-group-full {
            flex: 1 1 100%;
        }

        .form-group button {
            padding: 8px 16px;
            border: none;
            background-color: #5cb85c;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 5px;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .table-form input[type="text"] {
            width: 90%;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-group input[type="date"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* Additional styles for layout and responsiveness */
        @media (min-width: 768px) {
            .form-group {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                width: 10;
            }

            .form-group label {
                flex-basis: 40%;
                /* Adjust as needed */
                margin-right: 10px;
            }

            .form-group input[type="text"] {
                flex-basis: 30%;
                /* Adjust as needed */
                padding: 5px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }
        }

        .vendor_Add_btn {
            background-color: #28a745;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }

        .form-group select {
            width: 80%;
            height: 10%;
            padding: 10px;
            border-radius: 3px;
            /* Optional: to make the corners rounded */
        }
    </style>


</head>
{% include 'base.html' %}

<body>
    

    <div id="page-wrapper">
        <div class="header">
            <div class="navbar2">
                <p class="financial-year">Sales Details Form</p>


                <ol class="breadcrumb">
                    <li><i style="font-size: 10px; padding-top: 5px;" class="fa fa-tachometer"></i><a href="#">
                            &nbsp;&nbsp;Home</a></li>
                    <li class="active">Back to Add</li>
                </ol>
            </div>
        </div>
        <div class="container">
            <div class="header-container">
                <h2>SALES FORM</h2>
                <p>Date : {{ current_date|date:"d-m-Y " }}</p>
            </div>
            <br>


            <form name="form1" method="POST" action="/savesale/">{% csrf_token %}
                    <div class="form-group">
                        <table>
                            <tr>
                                <td>Customer type<br>
                                    <select class="waves-effect waves-dark" name="customer_type" id="customer_type">
                                        <option disabled selected>--Select--</option>
                                        <option value="Shareholder">Shareholder</option>
                                        <option value="Wholesale">Wholesale customer</option>
                                        <option value="Retail">Customers/Retailers</option>
                                        <option value="other">Others</option>
                                    </select>
                                </td>
                                <td>Bill Number<br><input style="width: 80%" type="text" id="bill_number" name="bill_number" value="{{bill_no}}"></td>
                                <td>Sale Date:<br><input style="width: 80%" type="date" id="purchase_date" name="purchase_date" value="{{ current_date|date:" d-m-Y " }}"></td>
                                <td>Entry Date:<br><input style="width: 80%;" type="date" id="reciept_date" name="reciept_date" value="{{ current_date|date:" d-m-Y " }}"></td>
                            </tr>
                            <tr>
                                <td>Customer Name<br>
                                    <select class="waves-effect waves-dark" name="customer_name_select" id="customer_name_select" onchange="fetchOldBalance()" >
                                        <option selected>--select--</option>
                                    </select>
                                    <input type="text" id="customer_name_input" name="customer_name_input" style="display: none; width: 80%;">
                                </td>
                                <td>MOP<br>
                                    <select class="waves-effect waves-dark" name="MOP" id="MOP">
                                        <option selected>--select--</option>
                                        <option value="cash">CASH</option>
                                        <option value="bank">BANK</option>
                                        <option value="credit">CREDIT</option>
                                    </select>
                                </td>
                            </tr>
                            <tr id="additional-fields-row" style="display: none;">
                                <td>Address<br><input style="width: 80%" type="text" id="address" name="address"></td>
                                <td>Mobile No<br><input style="width: 80%" type="text" id="mobile_no" name="mobile_no"></td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="form-buttons">
                                        <button type="button" class="save-btn" onclick="addRow()">Add</button>
                                        <button type="button" class="cancel-btn">Delete</button>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                
                <div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <div class="table-form">
                                    <table class="table table-bordered" id="purchasetable">
                                        <thead style="background-color: #343a40; color: #ffffff;">
                                            <tr>
                                                <th>Sl&nbsp;No</th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRODUCT&nbsp;CODE&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ITEM&nbsp;NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HSNCODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RATE&nbsp;TYPE&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RATE&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QTY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;DISCOUNT&nbsp;%&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;AMOUNT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;TAXABLE&nbsp;AMOUNT
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IGST&nbsp;%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;IGST&nbsp;AMOUNT&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CGST_%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;CGST_AMOUNT&nbsp;&nbsp;</th>

                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SGST_%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </th>
                                                <th>&nbsp;&nbsp;&nbsp;SGST_AMOUNT&nbsp;&nbsp;</th>

                                                <th>&nbsp;&nbsp;&nbsp;&nbsp;NETAMOUNT&nbsp;&nbsp;&nbsp;&nbsp;</th>
                                                
                                                <th>Delete</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Existing rows will be added dynamically -->
                                        </tbody>



                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="form-group">
                        <table>
                            <tr>

                                <td>Old Balance<br><input style="width: 50%" type="text" id="old-balance"
                                        name="old-balance" value = 0></td>
                                <td>Total Amount<br><input style="width: 50%" type="text" id="total-amount"
                                        name="total-amount"></td>
                                <td>Gross Total<br><input style="width: 50%" type="text" id="gross-amount"
                                        name="gross-amount"></td>
                                <td>&nbsp;</td>

                                <td>Qty Total<br><input style="width: 50%;" type="text" id="qty-total"
                                        name="qty-total"></td>
                            </tr>
                            <tr>
                                <td>Discount Amount<br><input style="width: 50%" type="text" id="discount-amount"
                                        name="discount-amount" ></td>
                                <td>Shareholder Discount(%)<br><input style="width: 50%" type="text" id="shareholder-discount" name="shareholder-discount" oninput="calculateNet()" value="0">
                                </td>
                                <td>Shareholder Discount Amount<br><input style="width: 50%" type="text" id="shareholder-discount-amt" name="shareholder-discount-amt" value = 0>
                                </td>
                                <td>&nbsp;</td>

                                <td>Received Amount<br><input style="width: 50%;"
                                        type="text" value="0" id="received-amount" name="received-amount" oninput="calculateBal()"></td>
                            </tr>

                            <tr>
                                <td>Balance<br><input style="width: 50%" type="text" id="balance" value="0"
                                        name="balance"></td>
                                <td></td>
                                <td>&nbsp;</td>
                                <td></td>
                                <td style="color: #023c7a;font-weight: bolder; font-size: 20px; ">Net Amount : <br><input style="width: 50%" type="text" id="net" value="0"
                                    name="net">
                                </td>
                            </tr>
                            <tr>
                            </tr>
                        </table>

                        
                        <div class="form-buttons">

                            <button type="submit" class="save-btn">Save</button>
                            <button type="button" class="cancel-btn">Cancel</button>
                        </div>
                    </div>
            </form>






        </div>
    </div>
    <script>
        let serialNumber = 1;

        function addRow() {
            const table = document.getElementById('purchasetable').getElementsByTagName('tbody')[0];
            const row = table.insertRow();
            row.innerHTML = `
                <td><input type="text" name="serial_number[]" value="${serialNumber++}" readonly></td>
                <td><input type="text" name="product_code[]" readonly></td>
                <td>
                    <select name="product_drop[]" class="form-control" onchange="updateProductField(this)">
                        <option value="">--SELECT--</option>
                        {% for i in prod %}
                            <option value="{{i.product_name}}">{{i.product_name}}</option>
                        {% endfor %}
                    </select>
                </td>
                <td><input type="text" name="hsncode[]"></td>
                <td>
                    <select name="rate_Type[]" class="form-control" onchange="updateRateField(this)">
                        <option value="">--SELECT--</option>
                        <option value="R1">R1</option>
                        <option value="R2">R2</option>
                        <option value="R3">R3</option>
                    </select>
                </td>
                <td><input type="text" name="rate[]" onchange="calculateAmounts(this)"></td>
                <td><input type="number" name="qty[]" oninput="calculateAmounts(this)"></td>
                <td><input type="text" name="discount[]" value="0" oninput="calculateAmounts(this)"><input  name="discountamt[]" type = "hidden"></td>
                <td><input type="text" name="amount[]" readonly></td>
                <td><input type="text" name="taxable-amt[]" readonly></td>
                <td><input type="text" name="igst[]" readonly></td>
                <td><input type="text" name="igst-amt[]" readonly></td>
                <td><input type="text" name="cgst[]" readonly></td>
                <td><input type="text" name="cgst-amt[]" readonly></td>
                <td><input type="text" name="sgst[]" readonly></td>
                <td><input type="text" name="sgst-amt[]" readonly></td>
                <td><input type="text" name="net-amt[]" readonly></td>
                <td><input type="button" class="btn btn-danger" value="delete" onclick="deleteRow(this)"></td>
            `;
        }

        function updateProductField(selectElement) {
            const selectedProduct = selectElement.value;
            const row = selectElement.parentElement.parentElement;
            const productCodeField = row.querySelector('input[name="product_code[]"]');
            const hsnField = row.querySelector('input[name="hsncode[]"]');
            const rateTypeField = row.querySelector('select[name="rate_Type[]"]');
            const rateField = row.querySelector('input[name="rate[]"]');
            const igstField = row.querySelector('input[name="igst[]"]');
            const cgstField = row.querySelector('input[name="cgst[]"]');
            const sgstField = row.querySelector('input[name="sgst[]"]');

            if (selectedProduct) {
                fetch(`/get-product-details/?product_name=${selectedProduct}`)
                    .then(response => response.json())
                    .then(data => {
                        productCodeField.value = data.product_code || '';
                        hsnField.value = data.hsn_code_description || '';
                        igstField.value = data.igst || '';
                        cgstField.value = data.cgst || '';
                        sgstField.value = data.sgst || '';

                        // Store the rates in the row's dataset
                        row.dataset.rateR1 = data.rate_r1 || '';
                        row.dataset.rateR2 = data.rate_r2 || '';
                        row.dataset.rateR3 = data.rate_r3 || '';

                        // Update the rate field based on the selected rate type
                        updateRateField(rateTypeField);
                    })
                    .catch(error => {
                        console.error('Error fetching product details:', error);
                    });
            } else {
                productCodeField.value = '';
                hsnField.value = '';
                igstField.value = '';
                cgstField.value = '';
                sgstField.value = '';
                row.dataset.rateR1 = '';
                row.dataset.rateR2 = '';
                row.dataset.rateR3 = '';
                rateField.value = '';
            }
        }

        function updateRateField(selectElement) {
            const row = selectElement.parentElement.parentElement;
            const rateField = row.querySelector('input[name="rate[]"]');
            const selectedRateType = selectElement.value;

            if (selectedRateType === 'R1') {
                rateField.value = row.dataset.rateR1 || '';
            } else if (selectedRateType === 'R2') {
                rateField.value = row.dataset.rateR2 || '';
            } else if (selectedRateType === 'R3') {
                rateField.value = row.dataset.rateR3 || '';
            } else {
                rateField.value = '';
            }

            calculateAmounts(rateField);
        }
        function calculateAmounts(element) {
            const row = element.parentElement.parentElement;
            
            const qty = parseFloat(row.querySelector('input[name="qty[]"]').value) || 0;
            const rate = parseFloat(row.querySelector('input[name="rate[]"]').value) || 0;
            const discount = parseFloat(row.querySelector('input[name="discount[]"]').value) || 0;

            const amount = qty * rate;
            const discountAmount = (amount * discount) / 100;
            const taxableAmount = amount - discountAmount;

            const igstRate = parseFloat(row.querySelector('input[name="igst[]"]').value) || 0;
            const cgstRate = parseFloat(row.querySelector('input[name="cgst[]"]').value) || 0;
            const sgstRate = parseFloat(row.querySelector('input[name="sgst[]"]').value) || 0;

            const igstAmount = (taxableAmount * igstRate) / 100;
            const cgstAmount = (taxableAmount * cgstRate) / 100;
            const sgstAmount = (taxableAmount * sgstRate) / 100;

            const netAmount = taxableAmount + igstAmount + cgstAmount + sgstAmount;
            

            row.querySelector('input[name="amount[]"]').value = amount.toFixed(2);
            row.querySelector('input[name="taxable-amt[]"]').value = taxableAmount.toFixed(2);
            row.querySelector('input[name="igst-amt[]"]').value = igstAmount.toFixed(2);
            row.querySelector('input[name="cgst-amt[]"]').value = cgstAmount.toFixed(2);
            row.querySelector('input[name="sgst-amt[]"]').value = sgstAmount.toFixed(2);
            row.querySelector('input[name="net-amt[]"]').value = netAmount.toFixed(2);
            row.querySelector('input[name="discountamt[]"]').value = discountAmount.toFixed(2);

            updateTotalAmounts();
        }
        function calculateNet(){
            const sd = parseFloat(document.getElementById('shareholder-discount').value) || 0;
            var netamt = parseFloat(document.getElementById('gross-amount').value) || 0;
            var ramt = parseFloat(document.getElementById('received-amount').value) || 0;
            const sdamt = ((netamt * sd)/100);
            netamt = netamt-sdamt
            document.getElementById('gross-amount').value = netamt.toFixed(2);
            document.getElementById('shareholder-discount-amt').value = sdamt.toFixed(2);
        }
        function calculateBal(){  
            var netamt = parseFloat(document.getElementById('gross-amount').value) || 0;
            var ramt = parseFloat(document.getElementById('received-amount').value) || 0;
            var bal = netamt - ramt;
            document.getElementById('balance').value = bal.toFixed(2);
            document.getElementById('net').value = ramt.toFixed(2);
    
        }
        function updateTotalAmounts() {
            let grossAmount = 0;
            let totalTaxableAmount = 0;
            let totalIgstAmount = 0;
            let totalCgstAmount = 0;
            let totalSgstAmount = 0;
            let netAmount = 0;
            let qtyTotal = 0;
            let amount = 0;
            let discountAmount = 0;
    

            document.querySelectorAll('input[name="amount[]"]').forEach(input => {
                grossAmount += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('input[name="taxable-amt[]"]').forEach(input => {
                totalTaxableAmount += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('input[name="igst-amt[]"]').forEach(input => {
                totalIgstAmount += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('input[name="cgst-amt[]"]').forEach(input => {
                totalCgstAmount += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('input[name="sgst-amt[]"]').forEach(input => {
                totalSgstAmount += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('input[name="net-amt[]"]').forEach(input => {
                amount += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('input[name="net-amt[]"]').forEach(input => {
                netAmount += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('input[name="qty[]"]').forEach(input => {
                qtyTotal += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('input[name="discountamt[]"]').forEach(input => {
                discountAmount += parseFloat(input.value) || 0;
            });
            const old_bal =  parseFloat(document.getElementById('old-balance').value);
            netAmount +=old_bal;
            // document.getElementById('gross-amt').value = grossAmount.toFixed(2);
            // document.getElementById('total-taxable-amt').value = totalTaxableAmount.toFixed(2);
            // document.getElementById('total-igst-amt').value = totalIgstAmount.toFixed(2);
            // document.getElementById('total-cgst-amt').value = totalCgstAmount.toFixed(2);
            // document.getElementById('total-sgst-amt').value = totalSgstAmount.toFixed(2);
            document.getElementById('discount-amount').value= discountAmount.toFixed(2);
            document.getElementById('total-amount').value = amount.toFixed(2);
            document.getElementById('gross-amount').value = netAmount.toFixed(2);
            document.getElementById('qty-total').value= qtyTotal.toFixed(2);
            
        }

        function deleteRow(button) {
            const row = button.parentElement.parentElement;
            row.parentElement.removeChild(row);
            updateTotalAmounts();
        }
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('customer_type').addEventListener('change', function () {
                var additionalFieldsRow = document.getElementById('additional-fields-row');
                if (this.value === 'other') {
                    additionalFieldsRow.style.display = 'table-row';
                } else {
                    additionalFieldsRow.style.display = 'none';
                }
            });
        });
    
        function toggleCustomerNameInput() {
    const selectElement = document.getElementById('customer_name_select');
    const inputElement = document.getElementById('customer_name_input');
    if (selectElement.value === 'other') {
        inputElement.style.display = 'inline';
        inputElement.name = 'customer_name';
    } else {
        inputElement.style.display = 'none';
        inputElement.name = 'customer_name_input';
    }
}

        document.getElementById('customer_type').addEventListener('change', function() {
            var customerType = this.value;
            var customerNameDropdown = document.getElementById('customer_name_select');
    
            // Clear the customer name dropdown
            customerNameDropdown.innerHTML = '<option selected>--select--</option>';
    
            if (customerType) {
                fetch(`/get_customers/?type=${customerType}`)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(customer => {
                            var option = document.createElement('option');
                            option.value = customer.name;
                            option.text = customer.name;
                            customerNameDropdown.appendChild(option);
                        });
                    });
            }
        });document.addEventListener('DOMContentLoaded', function () {
    var customerTypeSelect = document.getElementById('customer_type');
    var customerNameSelect = document.getElementById('customer_name_select');
    var customerNameInput = document.getElementById('customer_name_input');
    var additionalFieldsRow = document.getElementById('additional-fields-row');

    customerTypeSelect.addEventListener('change', function () {
        var customerType = this.value;
        
        if (customerType === 'other') {
            additionalFieldsRow.style.display = 'table-row';
            customerNameSelect.style.display = 'none';
            customerNameInput.style.display = 'block';
        } else {
            additionalFieldsRow.style.display = 'none';
            customerNameSelect.style.display = 'block';
            customerNameInput.style.display = 'none';
        }
        
        if (customerType && customerType !== 'other') {
            fetch(`/get_customers/?type=${customerType}`)
                .then(response => response.json())
                .then(data => {
                    customerNameSelect.innerHTML = '<option selected>--select--</option>';
                    data.forEach(customer => {
                        var option = document.createElement('option');
                        option.value = customer.name;
                        option.text = customer.name;
                        customerNameSelect.appendChild(option);
                    });
                });
        }
    });
});

async function fetchOldBalance() {
  const selectElement = document.getElementById('customer_name_select');
  const selectedUser = selectElement.value;

  if (selectedUser === '--select--') {
    document.getElementById('old_balance').innerText = '';
    return;
  }

  try {
    const response = await fetch(`/getOldBalance?user=${selectedUser}`);
    const data = await response.json();
    const oldBalance = data.oldBalance || 'Balance not found';

    // Set the value of the input field using .value property
    document.getElementById('old-balance').value = oldBalance;
  } catch (error) {
    console.error('Error fetching old balance:', error);
    document.getElementById('old_balance').innerText = 'Error fetching balance';
  }
}

    </script>
    
</body>

</html>